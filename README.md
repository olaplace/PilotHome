# PilotHome (MLapp)

PilotHome is a MarkLogic Enterprise DB and NodeJS (Express + Hogan) demo. It is based on those products:

  - MarkLogic 8.0-2
  - NodeJS v0.12.2
  - Express 4.12.1
  - Hogan 0.0.6

The NodeJS application name is *MLapp*.

## MLapp functional goal
The functional global context is about piloting Internet of Things within a house or flat.

> Basically, some IoT devices are connected within houses or flats. 
> Those devices allow to gather informations around 3 domains:
> - Health (getting informations about people's health)
> - Energy (getting informations electronic devices like lights or screens)
> - Safety (getting informations security within the house/flat like fire or watter)
>
> In addition some alerts can be raised for each one of the 3 domains :
> - AH-ON: corresponding to a Health domain Alert
> - AE-ON: corresponding to an Energy domain Alert
> - AS-ON: corresponding to a Safety domain Alert

The *MLapp* demo application allows to load JSON documents (generated by the 3 domains IoT devices) in the MarkLogic database.
Then, it is possible to request and search the database in different ways like searching for raised alerts.

## Install the *MLapp* application
### Prerequisite
You need to have:
- A running MarkLogic database 
- node.js installed (npm is installed with node.js). Node can be installed from here: *https://nodejs.org/*
- Express installed

### Installation

```sh
$ npm i -g gulp
```

```sh
$ git clone [git-repo-url] dillinger
$ cd dillinger
$ npm i -d
$ mkdir -p public/files/{md,html,pdf}
$ gulp build --prod
$ NODE_ENV=production node app
```

## MLapp usage
Once installed, it is possible to use the application with the following functionalities.

- Start the *MLapp* application (in the directory where you downloaded this package, the one with *app.js* file):
```sh
$ DEBUG=MLapp:* ./bin/www
```

- Home page of the application:
```sh
http://localhost:3000
```

- You then need to load the *testing* documents with the following URL:
```sh
http://localhost:3000/load
```
*Note that here you can also remove the documents from the database.*

- You are now ready to search for documents with the following URL:
```sh
http://localhost:3000/search
```

> As search examples, you can try :
> - *energy* for the domain criteria
> - Select (Search only where alerts raised) to get only the situation where an alert was raised
> - Select (Sort by person's name) in order to have the result sorted by the person'S name. Be aware that this functionality requires an Admin task on your database: you should add an *Element Range Indexes* of *type* "string" and *localname* "name". The search won't run properly if you selected the sort option without doing this Admin task!


### Todo's
Some additional content/functions that I would like to add:
 - Facet 
 - Semantics search
 - Geospatial search (the JSON loaded documents allow this)
 - Additional Query and Search

### Version
1.0.0

### Tech

MLapp uses a number of open source projects to work properly:
* [node.js] - evented I/O for the backend
* [Express] - fast node.js network app framework 
* [Twitter Hogan] - the Twitter version of Mustache Views rendering


License
----

MIT


**Free Software, Enjoy the MarkLogic demo!**


[node.js]:http://nodejs.org
[Twitter Hogan]:http://twitter.github.io/hogan.js/
[express]:http://expressjs.com


